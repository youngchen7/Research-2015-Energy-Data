<!DOCTYPE HTML>
<html>
<head>
	<title>ac_vis</title>
	<style>
		body {
			margin: 0;
			padding: 0;
			background-color: #000000;
		}
	</style>
	<script src="/js/pixi.min.js"></script>
	<script src="/js/shp.min.js"></script>

</head>
<body>
	<script>



	// create an new instance of a pixi stage
	var stage = new PIXI.Graphics();

	// create a renderer instance.
	//var renderer = new PIXI.CanvasRenderer(800, 800, {resolution: 2});
	var renderer = new PIXI.WebGLRenderer(800, 800, {antialias: true, resolution: 2});
	renderer.view.style.width = '800px';
	renderer.view.style.height = '800px';

	renderer.backgroundColor = 0xFFFFFF;

	// add the renderer view element to the DOM
	document.body.appendChild(renderer.view);

	requestAnimationFrame( animate );

	// create a texture from an image path
	var texture = PIXI.Texture.fromImage("/res/bunny.png");
	// create a new Sprite using the texture
	var bunny = new PIXI.Sprite(texture);

	// center the sprites anchor point
	bunny.anchor.x = 0.5;
	bunny.anchor.y = 0.5;

	// move the sprite to the corner of the screen
	bunny.position.x = 15;
	bunny.position.y = 15;

	stage.addChild(bunny);


	// load constituency file
	shp("/data/AC_India_Geo_Simpl/AC_ALLINDIA").then(function(geojson){
		var india = new PIXI.Graphics();
		var india_bounds = [68.11029052734375, 8.084136962890625, 97.40910339355469, 37.02901077270508];
		var india_cx = (india_bounds[0]+india_bounds[2])/2;
		var india_cy = (india_bounds[1]+india_bounds[3])/2;
		geojson.features.forEach(function(polygon)
		{
			var points = polygon.geometry.coordinates[0];

			var constituency = new PIXI.Graphics();

			var scale = {x:25, y:-25};

			var int_points = points.map(function(el){
				return [Math.trunc((el[0] - india_cx)*scale.x), Math.trunc((el[1] - india_cy)*scale.y)];
			})

			//Start drawing the constituency
			constituency.beginFill(0xFFFFFF);
			constituency.lineStyle(1, 0x000000);

			constituency.moveTo( int_points[0][0] , int_points[0][1] );

			for(var i = 1; i < points.length; ++i)
			{
				constituency.lineTo(int_points[i][0], int_points[i][1]);
			}
			//constituency.moveTo( int_points[0][0], int_points[0][1]);

			constituency.endFill();

			india.addChild(constituency);
		});
		india.position.x = 400;
		india.position.y = 400;
		stage.addChild(india);
	});

	function animate() {

	    requestAnimationFrame( animate );

	    // just for fun, lets rotate mr rabbit a little
	    bunny.rotation += 0.1;
	    // render the stage
	    renderer.render(stage);
	}

	</script>

	</body>
</html>
